# Intro
This pipeline integrates several bioinformatics tools/packages with the aim of facilitating the analysis of variant enrichment analysis (Deep Mutational Scanning data). Two approaches (command line and GUI) are provided. <br>
The statistical enrichment score is derived from Enrich2 results. 6 enrichment plots will be generated by default including 3 amino acids based and 3 codon based figures. Details regarding these plots can be found in Result section below.
This pipeline was tested on Mac OS X (10.15.1 and 10.13) with 16G memory.

This is version_2.5.
For trouble shooting, go to script/troubleshooting.txt file.

# Usage
## Setup
First need to install the required packages and configure the environment by running the setup.sh. <br>
You must have Anaconda3 installed first if you haven't done so. <br>
For best reproducibility, try to use conda 4.7.12, which can be found here: <br>
https://drive.google.com/file/d/1JyetMHr8USOZCj_IeLh1fmupu1DnsRwt/view?usp=sharing <br>

Download and unzip the git folder, open terminal, then: <br>
**cd scripts/** <br>
**bash setup.sh** <br>
It will take several minutes to install all components. <br>

## GUI approach
After setup, do: <br>
**bash gui.sh** <br>
The GUI is self-explanatory, simply choose wild type sequence, raw reads file and mutation sites and others. <br>

Note that in version 2.5, a new "Masked sites in WT" feature was implemented where you can specify the intentional mutations (for primer design purposes) and treat them as WT so that queries harboring these mutations won't be filtered out by the program as sequences carrying unexpected mutations. <br>

Enter and confirm 'Mode' and 'Scale'. Then, hit 'Submit'. It may take several minutes to finish depending on your computational power. <br>
Note that the 'Assay name' can't contain "-". <br>

## Command line approach
To learn how to use this mode, execute below for detailed instructions: <br>
**bash wrapper.sh -h** <br>
Some config_example_job.txt files are provided in the main directory. <br>
Instructions on how to prepare a config file can also be found at the top of example config files. <br>
Note that the configuration file setup is slightly different from that in version_1.0 and 2.0. <br>

# Result
Results will be saved in plot_output folder. <br>
By default, 6 plots will be created: 3 are amino acid based and 3 are codon based. <br>
The first plot is raw figure containing all amino acid/codon columns and standard error, the second is simplified version of raw figure with empty columns removed, the third is with empty columns and error bar both removed. <br>
Sample output plots are provided in result_example/job/plot_output folder. <br><br>
By default, all intermediate files will be kept, to free the space, save plot_output folder somewhere else for your own reference, then execute below to delete all intermediate files: <br>
**bash folder_clean.sh** <br>
Or, you can use the following command to move all intermediate files to result_example/job_X folder: <br>
**bash folder_move.sh job_X** <br>
Make sure to run folder_clean.sh to get rid of previous intermediate folders before running new jobs. <br>

# Examples
To repeat example_job1 and example_job2: <br>
**cd script/** <br>
Modify paths in config files accordingly, then: <br>
**bash wrapper.sh -c=../config_example_job1.txt** <br>
**bash wrapper.sh -c=../config_example_job2.txt** <br>
Example results are saved in result_example folder. <br>


# Update from version_2.0
1. Added in example data, reference, configuration files, GUI screen shots and results. <br>
2. Example configuration files are optimized and the parsing is different compared to version2.0. <br>
3. Tested and fixed the pytable installation bug when upgraded to MacOS 10.15.1 (Catalina). <br>
4. Fixed the potential duplication bug of folder ref and data_sra under the main directory when copying data. <br>
5. Fixed the color scale overflow bug when scale is set to be below max value of actual data value (all data above the specified scale will be set to color limit). <br>
6. Fixed the compatibility issue with conda 4.7.12 and optimized the setup procedure. <br>
7. Added a novel WT coordinate mask feature: when set, intentional mutations (for primer design purposes) outside target region will still be treated as WT. <br>

# Update from version_1.0
1. Added in double mutation data mode. <br>
2. Added in multiple flag options: -m/-c/-s. Details see Usage. <br>
3. Optimized the visualization <br>
4. Fixed the path space bug. <br>


**Questions and bugs report to Kai Hu: (hukai916@@@gmail.com).** <br>
